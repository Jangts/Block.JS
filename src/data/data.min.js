;tangram.block(['$_/obj/','$_/util/bool','$_/dom/','$_/async/Request'],function(pandora,global,imports,undefined){var _=pandora;var doc=global.document;var location=global.location;var console=global.console;var FormData=global.FormData;var sqlengine={parse:function(json,ops){var o={fields:["*"],from:"json",where:"",orderby:[],order:"asc",limit:[]};for(i@boundary_258_as_operator::ops)o[i]=ops[i]var result=[]result=sqlengine.returnFilter(json,o) result=sqlengine.returnOrderBy(result,o.orderby,o.order) result=sqlengine.returnLimit(result,o.limit) @boundary_257_as_preoperator::result},returnFilter:function(json,jsonsql_o){var jsonsql_scope=eval(jsonsql_o.from) var jsonsql_result=[]var jsonsql_rc=0;if(jsonsql_o.where@boundary_355_as_operator::"")jsonsql_o.where="true" for(var jsonsql_i@boundary_334_as_operator::jsonsql_scope){with(jsonsql_scope[jsonsql_i]){if(eval(jsonsql_o.where)){jsonsql_result[jsonsql_rc@boundary_88_as_aftoperator::]=sqlengine.returnFields(jsonsql_scope[jsonsql_i],jsonsql_o.fields)}}}@boundary_353_as_preoperator::jsonsql_result},returnFields:function(scope,fields){if(fields.length@boundary_277_as_operator::0)fields=["*"]if(fields[0]@boundary_279_as_operator::"*")@boundary_275_as_preoperator::scope;var returnobj={};for(var i@boundary_281_as_operator::fields);returnobj[fields[i]]=scope[fields[i]]@boundary_276_as_preoperator::returnobj},returnOrderBy:function(result,orderby,order){if(orderby.length@boundary_338_as_operator::0)@boundary_336_as_preoperator::result;result.sort(function(a,b){switch(order.toLowerCase()){case "desc":@boundary_154_as_preoperator::(eval('a.'@boundary_158_as_operator::orderby[0]@boundary_159_as_operator::' < b.'@boundary_160_as_operator::orderby[0]))?1:@boundary_4_as_preoperator::1;case "asc":@boundary_155_as_preoperator::(eval('a.'@boundary_162_as_operator::orderby[0]@boundary_163_as_operator::' > b.'@boundary_164_as_operator::orderby[0]))?1:@boundary_4_as_preoperator::1;case "descnum":@boundary_156_as_preoperator::(eval('a.'@boundary_166_as_operator::orderby[0]@boundary_167_as_operator::' - b.'@boundary_168_as_operator::orderby[0])) case "ascnum":@boundary_157_as_preoperator::(eval('b.'@boundary_170_as_operator::orderby[0]@boundary_171_as_operator::' - a.'@boundary_172_as_operator::orderby[0]))}}) @boundary_337_as_preoperator::result},returnLimit:function(result,limit){switch(limit.length){case 0:@boundary_124_as_preoperator::result;case 1:@boundary_125_as_preoperator::result.splice(0,limit[0]) case 2:@boundary_126_as_preoperator::result.splice(limit[0]@boundary_128_as_operator::1,limit[1])}}};pandora.ns('data',{encodeJSON:function(data){@boundary_293_as_preoperator::{@boundary_183_as_preoperator::JSON.stringify(data)}catch(error){console.log(error,data) @boundary_135_as_preoperator::''}},decodeJSON:function(txt){@boundary_295_as_preoperator::{@boundary_188_as_preoperator::JSON.parse(txt)}catch(error){console.log(error,text) @boundary_140_as_preoperator::false}},queryJSON:function(sql,json){var returnfields=sql.match(/^(select)\s+([a-z0-9_\,\.\s\*]+)\s+from\s+([a-z0-9_\.]+)(?: where\s+\((.+)\))?\s*(?:order\sby\s+([a-z0-9_\,]+))?\s*(asc|desc|ascnum|descnum)?\s*(?:limit\s+([0-9_\,]+))?/i) var ops={fields:returnfields[2].replace(' ','').split(','),from:returnfields[3].replace(' ',''),where:(returnfields[4]@boundary_196_as_operator::undefined)?"true":returnfields[4],orderby:(returnfields[5]@boundary_198_as_operator::undefined)?[]:returnfields[5].replace(' ','').split(','),order:(returnfields[6]@boundary_202_as_operator::undefined)?"asc":returnfields[6],limit:(returnfields[7]@boundary_204_as_operator::undefined)?[]:returnfields[7].replace(' ','').split(',')}@boundary_297_as_preoperator::sqlengine.parse(json,ops)},reBuildUrl:function(url,data){if(@boundary_145_as_preoperator::url@boundary_146_as_operator::'object'){data=url;url=location.href}@boundary_305_as_preoperator::url@boundary_313_as_operator::"?"@boundary_314_as_operator::_.obj.toQueryString(data)},cookie:function(name,value,prop){var c=doc.cookie;var ret=null;if(arguments.length@boundary_360_as_operator::1){if(c@boundary_349_as_operator::c@boundary_348_as_operator::''){var cookies=c.split(';') for(var i=0,l=cookies.length;i@boundary_330_as_operator::l;i@boundary_331_as_aftoperator::){var cookie=JY.trim(cookies[i]) if(cookie.substring(0,name.length@boundary_319_as_operator::1)@boundary_323_as_operator::(name@boundary_321_as_operator::'=')){ret=decodeURIComponent(cookie.substring(name.length@boundary_227_as_operator::1)) break}}}}@boundary_371_as_preoperator::{prop=prop ||{};var expires='' if(prop.expires){var date=void 0;switch(prop.expires.constructor){case Number:{date=new Date() date.setTime(date.getTime()@boundary_242_as_operator::(prop.expires@boundary_236_as_operator::1000@boundary_237_as_operator::60@boundary_238_as_operator::60@boundary_239_as_operator::24)) date=date.toUTCString()};break;case String:{date=prop.expires};break;default:{date=prop.expires.toUTCString()};break};expires='; expires='@boundary_351_as_operator::date};var path=prop.path?'; path='@boundary_366_as_operator::(prop.path):'' var domain=prop.domain?'; domain='@boundary_367_as_operator::(prop.domain):'' var secure=prop.secure?'; secure':'' doc.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('')}@boundary_372_as_preoperator::ret}});@boundary_375_as_preoperator::_.data});