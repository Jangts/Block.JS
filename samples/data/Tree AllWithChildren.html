<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Block.JS TREE | ALLWITHPARENTS</title>
    <script src="../../src/iBlock.js" data-use-debugmode></script>
</head>

<body>
    <script>
        /* 本测试主要测试如下 */
        /*
         * 1. 从语句块的可用性；
         * 2. 使用data.Tree类对文本进行编码和解码；
         */

        block(['$_/data/Tree.Cls'], function(_, global, undefined) {

            var
                list = [{
                    id: 1,
                    parent: 0,
                    text: 'A 顶级文本'
                }, {
                    id: 2,
                    parent: 0,
                    text: 'B 顶级文本'
                }, {
                    id: 3,
                    parent: 0,
                    text: 'C 顶级文本'
                }, {
                    id: 4,
                    parent: 1,
                    text: 'D 二级文本 rt A'
                }, {
                    id: 5,
                    parent: 1,
                    text: 'E 二级文本 rt A'
                }, {
                    id: 6,
                    parent: 1,
                    text: 'F 二级文本 rt A'
                }, {
                    id: 7,
                    parent: 2,
                    text: 'G 二级文本 rt B'
                }, {
                    id: 8,
                    parent: 2,
                    text: 'H 二级文本 rt B'
                }, {
                    id: 9,
                    parent: 2,
                    text: 'J 二级文本 rt B'
                }, {
                    id: 10,
                    parent: 3,
                    text: 'K 二级文本 rt C'
                }, {
                    id: 11,
                    parent: 3,
                    text: 'L 二级文本 rt C'
                }, {
                    id: 12,
                    parent: 3,
                    text: 'M 二级文本 rt C'
                }, {
                    id: 13,
                    parent: 4,
                    text: 'N 三级文本 rt D'
                }, {
                    id: 14,
                    parent: 4,
                    text: 'O 三级文本 rt D'
                }, {
                    id: 15,
                    parent: 4,
                    text: 'P 三级文本 rt D'
                }, {
                    id: 16,
                    parent: 5,
                    text: 'Q 三级文本 rt E'
                }, {
                    id: 17,
                    parent: 5,
                    text: 'R 三级文本 rt E'
                }, {
                    id: 18,
                    parent: 5,
                    text: 'S 三级文本 rt E'
                }, {
                    id: 19,
                    parent: 13,
                    text: 'T 四级文本 rt N'
                }, {
                    id: 20,
                    parent: 13,
                    text: 'U 四级文本 rt N'
                }],
                tree = new _.data.Tree(list, 'id', 'parent', 'level'),
                view = _.render({
                    margin: "10px auto 0",
                    textAlign: "left",
                    fontSize: "14px"
                }),
                result = tree.getAllWithChildren(0, 1).result,
                html = '',
                fn = function(result, level) {
                    _.each(result, function(i, div) {
                        html += '<div>|-&nbsp;';
                        for (var i = 1; i < level; i++) {
                            html += '&nbsp;&nbsp;';
                        }
                        html += div.text;
                        fn(div.children, level + 1);
                        html += '</div>';
                    });
                };
            fn(result, 1);
            view.innerHTML = html;
        }, true);
    </script>
</body>

</html>